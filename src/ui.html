<!doctype html>
<html>
  <body style="font-family: sans-serif; padding: 16px">
    <form id="form">
      <input id="id" placeholder="Client ID" style="width: 100%; margin-bottom: 8px" />
      <input id="secret" placeholder="Client Secret" type="password" style="width: 100%; margin-bottom: 8px" />
      <button type="submit">Send</button>
    </form>

    <button id="run">Run Quick Command</button>
<pre id="out"></pre>

    <script>
      document.getElementById("form").onsubmit = (e) => {
        e.preventDefault();
        parent.postMessage({
          pluginMessage: {
            type: "send-credentials",
            client_id: document.getElementById("id").value,
            client_secret: document.getElementById("secret").value,
          },
        }, "*");
      };

      document.getElementById('run').onclick = () => {
    parent.postMessage({
      pluginMessage: {
        type: "run-quick-command",
        commandId: "spec-to-sql", // exemplo
        payload: { exampleKey: "value" }
      }
    }, "*");
  };

  window.onmessage = (ev) => {
    const m = ev.data.pluginMessage;
    if (!m) return;
    if (m.type === "quick-command-response") {
      document.getElementById('out').textContent =
        JSON.stringify(m, null, 2);
    }
  };
    </script>
  </body>
</html>



<!-- novo -->

<body style="font-family: sans-serif; padding: 16px">
  <form id="form">
    <input id="secret" placeholder="client_secret" />
    <!-- o botÃ£o abaixo NÃƒO Ã© submit -->
    <button id="run" type="button">Run Quick Command</button>
  </form>

  <pre id="out"></pre>

  <script>
    // ðŸ”’ se alguÃ©m chamar fetch na UI, a gente loga
    (function guardFetch() {
      const _orig = window.fetch;
      window.fetch = function (...args) {
        console.warn("[UI] fetch chamado:", args[0]);
        return _orig.apply(this, args);
      };
    })();

    // impede submissÃ£o automÃ¡tica do form
    document.getElementById("form").onsubmit = (e) => {
      e.preventDefault();
      // se quiser enviar o secret pro main:
      parent.postMessage(
        {
          pluginMessage: {
            type: "send-credentials",
            client_secret: document.getElementById("secret").value,
          },
        },
        "*"
      );
    };

    // botÃ£o que dispara o run (sÃ³ mensagem, nada de fetch)
    document.getElementById("run").onclick = () => {
      parent.postMessage(
        {
          pluginMessage: {
            type: "run-quick-command",
            slug: "figma-to-query",
            payload: { exampleKey: "value" }, // ou inputs extras
          },
        },
        "*"
      );
    };

    // recebe respostas do main e mostra
    window.onmessage = (ev) => {
      const m = ev.data?.pluginMessage;
      if (!m) return;
      if (m.type === "quick-command-response") {
        document.getElementById("out").textContent = JSON.stringify(m, null, 2);
      }
    };
  </script>
</body>